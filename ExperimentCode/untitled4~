% make subwindow for cosine ramp for stimulus
filterparam = stimSize; %const.stimRadius_ypix;

imsize = filterparam*2+1;

[x, y] = meshgrid(-imsize/2+0.5:imsize/2-0.5, -imsize/2+0.5:imsize/2-0.5);
[~, r] = cart2pol(x,y);

alpha = zeros(imsize,imsize);

inner_radius = filterparam - const.stimCosEdge_pix; % 384 - 177 (or 44)
outer_radius = filterparam;

% ust added
cosX = linspace(-pi, 0, 1001);
cosY = (cos(cosX)+1)/2;
aa = r - inner_radius;
test = aa(aa < outer_radius-inner_radius);
test = test(test > inner_radius-inner_radius);
maxR = max(test); minR = min(test);

for ii = 1:imsize
    for jj = 1:imsize
        if r(ii,jj) < inner_radius
            alpha(ii,jj) = 0;
        elseif r(ii,jj) < outer_radius
            dist = r(ii,jj)-inner_radius;
            pick = (dist - minR) / (maxR - minR) *1000;
            choose = round(pick);
            alpha(ii,jj) = cosY(choose+1);
            %alpha(ii,jj) = (1-cosd(r(ii,jj)-inner_radius))/2;
        else
            alpha(ii,jj) = 1;
        end
    end
end

[aRows, aCols] = size(alpha);
% addcols = repmat([1], [aRows, round((finalX-(aCols))/2),1]);
% alpha = [addcols, alpha, addcols];
% [aRows, aCols] = size(alpha);
% addrows = repmat([1], [round((finalY-(aRows))/2), aCols,1]);
% alpha = [addrows; alpha; addrows];
% maskOuter(:,:,2) = alpha;